# last run on Sun Oct 30 23:37:57 EDT 2022
# last run on Sun Oct 30 23:37:53 EDT 2022
# last run on Wed Oct 26 15:26:32 EDT 2022
# last run on Wed Oct 26 15:26:28 EDT 2022
# last run on Wed Oct 26 15:22:39 EDT 2022
# last run on Wed Oct 26 15:22:33 EDT 2022
# last run on Wed Oct 26 09:51:32 EDT 2022
# last run on Wed Oct 19 13:30:52 EDT 2022
# last run on Wed Oct 19 13:30:47 EDT 2022
# last run on Mon Oct 17 09:21:45 EDT 2022
# last run on Mon Oct 17 09:21:40 EDT 2022
# last run on Thu Oct 13 11:44:30 EDT 2022
# last run on Wed Oct 12 19:35:33 EDT 2022
# last run on Wed Oct 12 19:35:29 EDT 2022
# last run on Tue Oct 11 09:15:13 MDT 2022
# last run on Tue Oct 11 09:15:07 MDT 2022
# last run on Mon Oct 10 10:13:56 MDT 2022
# last run on Mon Oct 10 10:13:51 MDT 2022
# last run on Wed Oct  5 11:00:52 EDT 2022
# last run on Mon Oct  3 00:55:46 EDT 2022
# last run on Wed Sep 28 20:09:44 EDT 2022
# last run on Tue Sep 27 10:33:21 EDT 2022
# last run on Tue Sep 27 10:33:17 EDT 2022
# last run on Tue Sep 27 09:23:09 EDT 2022
# last run on Tue Sep 27 09:23:06 EDT 2022
# last run on Tue Sep 27 09:17:34 EDT 2022
# last run on Tue Sep 27 09:17:30 EDT 2022
# last run on Tue Sep 27 09:17:13 EDT 2022
# last run on Tue Sep 27 09:17:07 EDT 2022
# last run on Mon Sep 26 16:26:42 EDT 2022
# last run on Thu Sep 15 14:07:55 EDT 2022
# last run on Thu Sep 15 14:07:50 EDT 2022
# last run on Thu Sep 15 14:03:38 EDT 2022
# last run on Thu Sep 15 13:57:13 EDT 2022
# last run on Fri Sep  9 12:28:54 EDT 2022
# last run on Thu Sep  8 13:49:10 EDT 2022
# last run on Sun Aug 28 22:06:52 EDT 2022
# last run on Sun Aug 28 16:44:58 EDT 2022
# last run on Sun Aug 28 16:44:54 EDT 2022
# last run on Tue Aug 23 11:37:04 EDT 2022
# last run on Tue Aug 23 11:37:01 EDT 2022
# last run on Mon Aug 22 23:46:42 EDT 2022
# last run on Mon Aug 22 23:46:31 EDT 2022
# last run on Fri Aug 19 14:04:22 EDT 2022
# last run on Fri Aug 19 14:04:10 EDT 2022
# last run on Fri Aug 12 11:10:54 EDT 2022
# last run on Fri Aug 12 11:10:50 EDT 2022
# last run on Thu Aug 11 10:11:04 EDT 2022
# last run on Thu Aug 11 10:11:00 EDT 2022
# last run on Thu Aug 11 10:05:27 EDT 2022
# last run on Thu Aug 11 10:05:23 EDT 2022
# last run on Thu Aug 11 10:03:01 EDT 2022
# last run on Thu Aug 11 10:02:55 EDT 2022
# last run on Tue Aug  9 10:16:02 EDT 2022
# last run on Fri Jul 29 14:38:04 EDT 2022
# last run on Thu Jul 28 20:41:16 EDT 2022
# last run on Mon Jul 11 05:59:47 HST 2022
# last run on Sun Jul 10 00:50:49 EDT 2022
# last run on Thu Jul  7 10:05:45 EDT 2022
# last run on Mon Jul  4 21:21:29 EDT 2022
# last run on Mon Jul  4 14:47:51 EDT 2022
# last run on Sat Jul  2 17:56:13 EDT 2022
# last run on Thu Jun 30 06:37:50 EDT 2022
# last run on Thu Jun 30 06:37:36 EDT 2022
# last run on Mon Jun 27 09:23:23 EDT 2022
# last run on Fri Jun 24 06:35:46 EDT 2022
# last run on Wed Jun 22 23:41:27 EDT 2022
# last run on Tue Jun 14 08:20:55 EDT 2022
# last run on Thu May 26 14:35:15 EDT 2022
# last run on Fri May  6 08:55:33 EDT 2022
# last run on Mon May  2 14:13:09 EDT 2022
# last run on Thu Apr 28 08:55:36 EDT 2022
# last run on Wed Apr 27 13:59:44 EDT 2022
# last run on Mon Apr 25 09:35:52 EDT 2022
# last run on Sat Apr 23 12:42:51 EDT 2022
# last run on Sat Apr 16 11:25:33 EDT 2022
# last run on Wed Apr 13 17:53:49 EDT 2022
# last run on Mon Apr 11 14:00:59 EDT 2022
# last run on Fri Apr  8 16:06:39 EDT 2022
# last run on Wed Apr  6 11:57:25 EDT 2022
# last run on Mon Mar 28 21:44:26 EDT 2022
# last run on Wed Mar 16 09:32:02 EDT 2022
# last run on Mon Mar  7 11:50:21 EST 2022
# last run on Thu Mar  3 15:17:00 EST 2022
# last run on Wed Mar  2 12:37:26 EST 2022
# last run on Tue Mar  1 23:22:56 EST 2022
# last run on Thu Feb 24 13:42:53 EST 2022
# last run on Mon Feb 21 10:59:34 EST 2022
# last run on Sat Feb 19 22:31:32 EST 2022
# last run on Mon Feb 14 08:56:40 EST 2022
# last run on Thu Feb 10 10:25:28 EST 2022
# last run on Wed Feb  9 14:00:21 EST 2022
# last run on Wed Feb  9 11:10:35 EST 2022
# last run on Tue Feb  8 09:12:51 EST 2022
# last run on Mon Feb  7 08:49:22 EST 2022
# last run on Sun Feb  6 15:54:03 EST 2022
# last run on Wed Feb  2 11:58:20 EST 2022
# last run on Tue Feb  1 16:25:06 EST 2022
# last run on Sun Jan 30 13:54:57 EST 2022
# last run on Sun Jan 30 13:54:38 EST 2022
# last run on Wed Jan 19 13:27:26 EST 2022
# last run on Wed Jan 12 10:26:10 EST 2022
# last run on Tue Jan 11 20:30:13 EST 2022
# last run on Tue Jan 11 20:24:29 EST 2022
# last run on Tue Jan 11 11:39:36 EST 2022
# last run on Sat Jan  8 17:08:22 EST 2022
# last run on Wed Jan  5 17:09:54 EST 2022
# last run on Sat Dec 11 19:33:01 EST 2021
# last run on Sun Dec  5 12:04:19 EST 2021
# last run on Fri Nov 26 14:00:17 EST 2021
# last run on Thu Nov 25 01:20:12 EST 2021
# last run on Wed Nov 24 10:09:56 EST 2021
# last run on Tue Nov 23 21:54:00 EST 2021
# last run on Wed Nov 17 09:27:56 EST 2021
# last run on Wed Nov 17 01:20:33 EST 2021
# last run on Sun Nov 14 17:00:51 EST 2021
# last run on Sun Nov 14 13:47:52 EST 2021
# last run on Fri Nov 12 10:34:00 EST 2021
# last run on Wed Nov 10 19:37:02 EST 2021
# last run on Tue Nov  9 10:56:30 EST 2021
# last run on Thu Nov  4 01:26:45 EDT 2021
# last run on Wed Oct 27 15:38:43 EDT 2021
# last run on Tue Oct 26 20:15:20 EDT 2021
# last run on Wed Oct 20 10:45:33 EDT 2021
# last run on Tue Oct 19 14:01:30 EDT 2021
# last run on Wed Oct 13 02:00:37 EDT 2021
# last run on Tue Oct 12 11:20:00 EDT 2021
# last run on Wed Oct  6 09:46:38 EDT 2021
# last run on Tue Oct  5 09:25:44 EDT 2021
# last run on Wed Sep 29 13:28:56 EDT 2021
# last run on Mon Sep 27 15:54:28 EDT 2021
# last run on Thu Sep 23 11:38:58 EDT 2021
# last run on Mon Sep 20 15:34:28 EDT 2021
# last run on Thu Sep 16 20:08:34 EDT 2021
# last run on Tue Sep 14 11:58:50 EDT 2021
# last run on Mon Sep 13 12:55:22 EDT 2021
# last run on Sat Sep 11 19:19:51 EDT 2021
# last run on Sat Sep 11 19:19:38 EDT 2021
# last run on Sat Sep 11 19:12:06 EDT 2021
# last run on Sat Sep 11 11:45:50 EDT 2021
# last run on Tue Aug 31 14:09:05 EDT 2021
# last run on Tue Aug 24 21:40:26 EDT 2021
# last run on Sun Aug  8 14:01:43 EDT 2021
# last run on Fri Aug  6 22:53:10 EDT 2021
# last run on Thu Aug  5 13:56:43 EDT 2021
# last run on Thu Aug  5 13:54:46 EDT 2021
# last run on Thu Aug  5 00:27:08 EDT 2021
# last run on Tue Aug  3 17:04:41 EDT 2021
# last run on Fri Jul 30 15:53:36 EDT 2021
# last run on Tue Jul 27 10:30:16 EDT 2021
# last run on Thu Jul 22 11:50:41 EDT 2021
# last run on Wed Jul 21 10:02:16 EDT 2021
# last run on Tue Jul 20 10:00:39 EDT 2021
# last run on Mon Jul 19 10:02:35 EDT 2021
# last run on Fri Jul 16 23:20:58 EDT 2021
# last run on Fri Jul 16 00:18:59 EDT 2021
# last run on Tue Jul 13 11:15:28 EDT 2021
# last run on Mon Jul 12 12:20:13 EDT 2021
# last run on Sun Jul 11 20:41:45 EDT 2021
# last run on Wed Jul  7 10:14:27 EDT 2021
# last run on Tue Jul  6 14:53:23 EDT 2021
# last run on Mon Jul  5 17:37:28 EDT 2021
# last run on Sat Jul  3 17:06:26 EDT 2021
# last run on Fri Jul  2 08:48:01 EDT 2021
# last run on Thu Jul  1 14:18:06 EDT 2021
# last run on Tue Jun 29 15:38:13 EDT 2021
# last run on Mon Jun 28 11:30:06 EDT 2021
# last run on Fri Jun 25 13:15:35 EDT 2021
# last run on Fri Jun 25 10:53:21 EDT 2021
# last run on Thu Jun 24 15:04:05 EDT 2021
# last run on Tue Jun 22 10:18:08 EDT 2021
# last run on Mon Jun 21 10:34:29 EDT 2021
# last run on Sun Jun 20 17:41:10 EDT 2021
# last run on Sun Jun 20 11:23:26 EDT 2021
# last run on Thu Jun 17 10:48:02 EDT 2021
# last run on Wed Jun 16 09:46:44 EDT 2021
# last run on Tue Jun 15 09:25:04 EDT 2021
# last run on Mon Jun 14 15:59:07 EDT 2021
# last run on Sun Jun 13 20:22:21 EDT 2021
# last run on Thu Jun 10 10:28:58 EDT 2021
# last run on Wed Jun  9 11:38:24 EDT 2021
# last run on Tue Jun  8 10:02:21 EDT 2021
# last run on Tue Jun  8 10:01:54 EDT 2021
# last run on Sun May 30 12:43:03 EDT 2021
# last run on Sun May 30 12:40:50 EDT 2021
# last run on Tue May 25 14:45:21 EDT 2021
# last run on Fri May 21 15:56:28 EDT 2021
# last run on Sun May 16 18:40:17 EDT 2021
# last run on Wed May 12 22:55:43 EDT 2021
# last run on Sun May  9 22:06:23 EDT 2021
# last run on Thu May  6 16:49:35 EDT 2021
# last run on Tue Apr 27 17:42:38 EDT 2021
# last run on Tue Apr 27 15:10:36 EDT 2021
# last run on Tue Apr 27 09:26:57 EDT 2021
# last run on Tue Apr 27 09:24:12 EDT 2021
# last run on Wed Apr 21 15:14:20 EDT 2021
# last run on Mon Apr 19 14:01:40 EDT 2021
# last run on Thu Apr  8 14:58:10 EDT 2021
# last run on Tue Apr  6 23:40:41 EDT 2021
# last run on Wed Mar 24 14:03:56 EDT 2021
# last run on Mon Mar 22 10:12:43 EDT 2021
# last run on Fri Mar 19 15:40:47 EDT 2021
# last run on Wed Mar 17 00:00:06 EDT 2021
# last run on Mon Mar 15 16:07:59 EDT 2021
# last run on Thu Mar 11 15:56:19 EST 2021
# last run on Thu Mar 11 15:30:43 EST 2021
# last run on Mon Feb 22 10:49:48 EST 2021
# last run on Sun Feb 21 11:01:28 EST 2021
# last run on Fri Feb 19 11:46:07 EST 2021
# last run on Thu Feb 18 15:38:12 EST 2021
# last run on Wed Feb 17 12:54:47 EST 2021
# last run on Wed Feb 10 15:39:22 EST 2021
# last run on Fri Feb  5 09:54:02 EST 2021
# last run on Thu Feb  4 14:49:13 EST 2021
# last run on Wed Feb  3 13:56:53 EST 2021
# last run on Sun Jan 31 20:26:54 EST 2021
# last run on Sun Jan 31 16:25:45 EST 2021
# last run on Sat Jan 23 22:41:47 EST 2021
# last run on Wed Jan 20 10:45:01 EST 2021
# last run on Tue Jan 19 05:20:23 EST 2021
# last run on Tue Jan 19 04:49:21 EST 2021
# last run on Mon Jan 18 15:23:32 EST 2021
# last run on Sun Jan 17 12:53:39 EST 2021
# last run on Tue Jan  5 10:43:10 EST 2021
# last run on Mon Jan  4 11:33:36 EST 2021
# last run on Tue Dec 29 14:23:21 EST 2020
# last run on Mon Dec 28 13:32:22 EST 2020
# last run on Wed Dec 23 22:52:05 EST 2020
# last run on Tue Dec 22 20:24:50 EST 2020
# last run on Thu Dec 10 16:18:53 EST 2020
# last run on Thu Dec 10 14:42:23 EST 2020
# last run on Tue Dec  8 13:48:00 EST 2020
# last run on Tue Dec  8 10:16:12 EST 2020
# last run on Fri Dec  4 16:52:09 EST 2020
# last run on Thu Dec  3 21:54:36 EST 2020
# last run on Thu Dec  3 11:16:58 EST 2020
# last run on Tue Dec  1 16:32:04 EST 2020
# last run on Tue Dec  1 11:24:35 EST 2020
# last run on Tue Nov 24 17:42:44 EST 2020
# last run on Mon Nov 23 07:10:23 EST 2020
# last run on Fri Nov 20 23:56:36 EST 2020
# last run on Wed Nov 18 17:48:32 EST 2020
# last run on Sun Nov 15 17:57:07 EST 2020
# last run on Fri Nov 13 17:26:19 EST 2020
# last run on Wed Nov 11 12:03:35 EST 2020
# last run on Tue Nov 10 23:51:32 EST 2020
# last run on Mon Nov  2 00:35:40 EST 2020
# last run on Sun Nov  1 10:48:42 EST 2020
# last run on Wed Oct 28 16:43:57 EDT 2020
# last run on Tue Oct 27 15:13:31 EDT 2020
# last run on Fri Oct 23 23:16:29 EDT 2020
# last run on Fri Oct 23 02:55:08 EDT 2020
# last run on Wed Oct 21 13:17:54 EDT 2020
# last run on Tue Oct 20 01:00:23 EDT 2020
# last run on Wed Oct  7 15:49:27 EDT 2020
# last run on Tue Oct  6 10:53:54 EDT 2020
# last run on Wed Sep 23 16:52:20 EDT 2020
# last run on Tue Sep 22 13:39:57 EDT 2020
# last run on Mon Sep 21 15:37:56 EDT 2020
# last run on Sun Sep 20 17:30:40 EDT 2020
# last run on Mon Sep 14 16:07:26 EDT 2020
# last run on Mon Sep 14 01:33:03 EDT 2020
# last run on Tue Sep  8 11:36:02 EDT 2020
# last run on Wed Sep  2 12:07:24 EDT 2020
# last run on Thu Aug 27 16:59:22 EDT 2020
# last run on Sun Aug 23 13:41:00 EDT 2020
# last run on Sat Aug 22 11:59:27 EDT 2020
# last run on Wed Aug 19 14:05:57 EDT 2020
# last run on Mon Aug 17 14:15:16 EDT 2020
# last run on Fri Aug 14 17:02:46 EDT 2020
# last run on Wed Aug 12 14:55:41 EDT 2020
# last run on Sat Aug  8 10:56:24 EDT 2020
# last run on Sat Aug  1 15:36:06 EDT 2020
# last run on Mon Jul 27 00:42:27 EDT 2020
# last run on 07/17/2020 14:28:00
# last run on 07/06/2020 03:16:00
# last run on 06/25/2020 09:19:00
# last run on 06/10/2020 02:03:00
# last run on 05/31/2020 16:12:00
# last run on 05/27/2020 00:05:00
# last run on 05/20/2020 13:37:00
# last run on 05/08/2020 11:25:00
# last run on 04/27/2020 16:49:00
# last run on 04/22/2020 23:13:00
# last run on 04/21/2020 23:05:00
# last run on 04/18/2020 15:42:00
# last run on 04/18/2020 00:17:00
# last run on 04/16/2020 15:04:00
# last run on 04/15/2020 13:56:00
# last run on 04/13/2020 13:28:00
# last run on 04/11/2020 22:06:00
# last run on 04/10/2020 14:34:00
# last run on 04/09/2020 14:14:00
# last run on 04/08/2020 13:20:00
# last run on 04/07/2020 11:00:00
# last run on 04/06/2020 10:00:00
# last run on 04/04/2020 21:00:00

#!/usr/bin/env python

# In[2]:


import pandas as pd
import geopandas as gpd


# In[3]:


# retrieve data of confirmed cases
url1 = 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv'
US_confirmed = pd.read_csv(url1, dtype={'UID': str})


# In[4]:


# retrieve data of deaths
url2 = 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv'
US_death = pd.read_csv(url2, dtype={'UID': str})


# In[5]:


# extract data from PA, MI,and NY
#PA_confirmed = US_confirmed[US_confirmed.UID.str.contains('84042')]
#MI_confirmed = US_confirmed[US_confirmed.UID.str.contains('84026')]
#NY_confirmed = US_confirmed[US_confirmed.UID.str.contains('84036')]
PA_MI_NY_confirmed = US_confirmed[US_confirmed['UID'].str.contains('84042|84026|84036', na=False)]
PA_MI_NY_death = US_death[US_death['UID'].str.contains('84042|84026|84036', na=False)]


# In[6]:


# remove additional columns
#PA_confirmed = PA_confirmed.iloc[:,[5]+list(range(11, len(PA_confirmed.columns), 1))]
#MI_confirmed = MI_confirmed.iloc[:,[5]+list(range(11, len(MI_confirmed.columns), 1))]
#NY_confirmed = NY_confirmed.iloc[:,[5]+list(range(11, len(NY_confirmed.columns), 1))]
PA_MI_NY_confirmed = PA_MI_NY_confirmed.iloc[:,[5,6,-1]]
PA_MI_NY_death = PA_MI_NY_death.iloc[:,[5,6,-1]]


# In[7]:


date = PA_MI_NY_confirmed.columns[2]


# In[8]:


# rename column names
PA_MI_NY_confirmed.rename(columns={'Admin2': 'County', 'Province_State': 'State',
                                   PA_MI_NY_confirmed.columns[2]: 'confirmed_cases'}, inplace=True)
PA_MI_NY_death.rename(columns={'Admin2': 'County', 'Province_State': 'State',
                               PA_MI_NY_death.columns[2]: 'deaths'}, inplace=True)


# In[9]:


PA_MI_NY_confirmed['Date'] = date
PA_MI_NY_death['Date'] = date


# In[10]:


# convert time column to time type
PA_MI_NY_confirmed['Date'] = pd.to_datetime(PA_MI_NY_confirmed['Date'])
PA_MI_NY_death['Date'] = pd.to_datetime(PA_MI_NY_death['Date'])


# In[11]:


PA_MI_NY_confirmed['State'].replace({"Pennsylvania": "PA", "Michigan": "MI", "New York": "NY"}, inplace=True)
PA_MI_NY_death['State'].replace({"Pennsylvania": "PA", "Michigan": "MI", "New York": "NY"}, inplace=True)


# In[12]:


# import county boundary geojson file
PA_county = gpd.read_file('../jaywt.github.io/covid19/county_boundary/PA_County.geojson')
MI_county = gpd.read_file('../jaywt.github.io/covid19/county_boundary/MI_County.geojson')
NY_county = gpd.read_file('../jaywt.github.io/covid19/county_boundary/NY_County.geojson')


# In[13]:


PA_MI_NY_boundary = pd.concat([PA_county, MI_county, NY_county], ignore_index=True)


# In[14]:


# remove additional columns in geojson
PA_MI_NY_boundary = PA_MI_NY_boundary.iloc[:,[2,6,19]]


# In[15]:


PA_MI_NY_boundary.rename(columns={'name': 'County', 'stusab': 'State', 'geometry': 'geometry'}, inplace=True)


# In[16]:


# merge number of cases file into geojson
PA_MI_NY_data = PA_MI_NY_boundary.merge(PA_MI_NY_confirmed, on=['County','State'])
PA_MI_NY_death_data = PA_MI_NY_boundary.merge(PA_MI_NY_death, on=['County','State'])


# In[17]:


PA_MI_NY_data.to_file("../jaywt.github.io/covid19/PA_MI_NY_latest_confirmed.geojson", driver='GeoJSON')


# In[18]:


PA_MI_NY_death_data.to_file("../jaywt.github.io/covid19/PA_MI_NY_latest_death.geojson", driver='GeoJSON')


# In[19]:


#########################
# codes bin
#########################
# convert from wide to long format
# PA_confirmed_long = pd.melt(PA_confirmed, id_vars=['Admin2'])

# PA_confirmed_long['time'] = PA_confirmed_long['time'].dt.strftime('%Y-%m-%d'+'T00:00:00')

# PA_county.to_file("PA_county_cases.geojson", driver='GeoJSON')

# PA_test = PA_county[PA_county['time'].isin(['2020-04-01T00:00:00', '2020-04-02T00:00:00'])]
# PA_test.to_file("PA_county_twodayscases.geojson", driver='GeoJSON')
